<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Scores</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #scores {
            display: table;
            font-family: 'Roboto Mono', monospace;
            font-size: 48px;
            font-weight: 600;
            color: white;
            padding: 20px;
        }
        .row {
            display: table-row;
        }
        .cell {
            display: table-cell;
            padding: 0 20px; /* Increase padding for more space */
            height: 132%; /* Increase cell height by 32% */
        }
        .name-left {
            text-align: right; /* Align right */
            width: 5ch; /* Enough for 5 letters */
        }
        .score-left {
            text-align: left;
            width: 3ch; /* Enough for 3 letters */
        }
        .races {
            text-align: center;
            width: 3ch; /* Enough for 3 letters */
        }
        .score-right {
            text-align: right;
            width: 3ch; /* Enough for 3 letters */
        }
        .name-right {
            text-align: left; /* Align left */
            width: 5ch; /* Enough for 5 letters */
        }
    </style>
</head>
<body>
    <div id="scores"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const tableId = urlParams.get('table_id') || 'default';
        
        fetch(`https://mkw-table-bot-api.jprq.site/api/json/team_scores/${tableId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Data fetched successfully:', data); // Log data for debugging
                // Get the scores container
                const scoresContainer = document.getElementById('scores');

                // Create an array to store team names and scores
                const teamScores = [];

                // Loop through each team and get their names and scores
                Object.keys(data.teams).forEach(teamKey => {
                    const team = data.teams[teamKey];
                    teamScores.push({
                        name: team.table_tag_str.replace(/#\w+/, '').trim(),
                        score: team.total_score,
                        hasBlitzu: Object.values(team.players).some(player => player.lounge_name === 'blitzu')
                    });
                });

                // Sort the teamScores array to ensure the team with "blitzu" is first if it exists
                teamScores.sort((a, b) => b.hasBlitzu - a.hasBlitzu);

                // Create elements to display the team scores in the specified format
                const row = document.createElement('div');
                row.className = 'row';

                const name1 = document.createElement('div');
                name1.className = 'cell name-left';
                name1.textContent = teamScores[0].name;

                const score1 = document.createElement('div');
                score1.className = 'cell score-left';
                score1.textContent = teamScores[0].score;

                const races = document.createElement('div');
                races.className = 'cell races';
                races.textContent = `R${data.races_played}`;

                const score2 = document.createElement('div');
                score2.className = 'cell score-right';
                score2.textContent = teamScores[1].score;

                const name2 = document.createElement('div');
                name2.className = 'cell name-right';
                name2.textContent = teamScores[1].name;

                // Append the cells to the row
                row.appendChild(name1);
                row.appendChild(score1);
                row.appendChild(races);
                row.appendChild(score2);
                row.appendChild(name2);

                // Append the row to the scores container
                scoresContainer.appendChild(row);
            })
            .catch(error => {
                console.error('Error fetching data:', error); // Log error for debugging
            });
    </script>
</body>
</html>
